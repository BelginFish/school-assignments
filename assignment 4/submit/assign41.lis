                        .module assign41.c
                        .area text
 0000                   .dbfile M:\SYSC20~2\Assignments\ASSIGN~3\PART1~1/../lib/keyboard.c
 0000                   .dbfunc s keyboard_init _keyboard_init fV
 0000           _keyboard_init:
 0000                   .dbline -1
 0000                   .dbline 17
 0000           ; #include <hcs12dp256.h>
 0000           ; #include <stdio.h>
 0000           ; #include "../lib/keyboard.c"
 0000           ; 
 0000           ; int main()
 0000           ; {
 0000           ;       char key;
 0000           ;       
 0000           ;       // Setup terminal
 0000           ;       setbaud(BAUD19K);
 0000           ;       
 0000           ;       while ( 1 ) {
 0000           ;               key = keyboard_getchar();
 0000           ;               putchar(key);
 0000           ;               
 0000           ;               if ( key == '0' ) {
 0000           ;                       break;
 0000                   .dbline 18
 0000           ;               }
 0000 7900F0            clr 0xf0
 0003                   .dbline 19
 0003           ;       }
 0003 C60F              ldab #15
 0005 7B025A            stab 0x25a
 0008                   .dbline 20
 0008           ;       
 0008 1D0262F0          bclr 0x262,#0xf0
 000C                   .dbline -2
 000C                   .dbline 21
 000C           ;       return 1;
 000C           L3:
 000C                   .dbline 0 ; func end
 000C 3D                rts
 000D                   .dbend
                        .area data
 0000                   .dbfile M:\SYSC20~2\Assignments\ASSIGN~3\PART1~1/../lib/keyboard.c
 0000           L5:
 0000                   .blkb 2
                        .area idata
 0000 FFFF              .word -1
                        .area data
 0002                   .dbfile M:\SYSC20~2\Assignments\ASSIGN~3\PART1~1/../lib/keyboard.c
 0002           L6:
 0002                   .blkb 2
                        .area idata
 0002 FFFF              .word -1
                        .area data
 0004                   .dbfile M:\SYSC20~2\Assignments\ASSIGN~3\PART1~1/../lib/keyboard.c
                        .area text
 000D                   .dbfile M:\SYSC20~2\Assignments\ASSIGN~3\PART1~1/../lib/keyboard.c
 000D           L7:
 000D 3132              .byte 49,50
 000F 3341              .byte 51,'A
 0011 3435              .byte 52,53
 0013 3642              .byte 54,'B
 0015 3738              .byte 55,56
 0017 3943              .byte 57,'C
 0019 4530              .byte 'E,48
 001B 4644              .byte 'F,'D
 001D                   .dbfunc e keyboard_getchar _keyboard_getchar fc
 001D                   .dbsym s last_col L6 I
 001D                   .dbsym s last_row L5 I
 001D           ;       char_map -> -20,x
 001D           ;            col -> -4,x
 001D           ;            row -> -2,x
 001D           _keyboard_getchar::
 001D 34                pshx
 001E B775              tfr s,x
 0020 1BF1E6            leas -26,sp
 0023                   .dbline -1
 0023                   .dbline 27
 0023           ; }
 0023           ; }
 0023           ; }
 0023           ; }
 0023           ; }
 0023           ; }
 0023                   .dbline 30
 0023           ; }
 0023           ; }
 0023           ; }
 0023 CC0000            ldd #0
 0026 6C1E              std -2,x
 0028                   .dbline 31
 0028           ; }
 0028 CC0000            ldd #0
 002B 6C1C              std -4,x
 002D                   .dbline 33
 002D           ; }
 002D           ; }
 002D 19E1EC            leay -20,x
 0030 B7C6              xgdy
 0032 CD000D            ldy #L7
 0035 34                pshx
 0036 B745              tfr d,x
 0038 CC0008            ldd #8
 003B           X0:
 003B 18027131          movw 2,y+,2,x+
 003F 0434F9            dbne d,X0
 0042 30                pulx
 0043                   .dbline 38
 0043           ; }
 0043           ; }
 0043           ; }
 0043           ; }
 0043           ; }
 0043 160000            jsr _keyboard_init
 0046 18200089          lbra L9
 004A           L8:
 004A                   .dbline 40
 004A           ; }
 004A           ; }
 004A                   .dbline 41
 004A           ; }
 004A CC0001            ldd #1
 004D ED1E              ldy -2,x
 004F 8D0000            cpy #0
 0052 2704              beq X1
 0054           X2:
 0054 59                lsld
 0055 0436FC            dbne y,X2
 0058           X1:
 0058 7B0258            stab 0x258
 005B                   .dbline 42
 005B           ; }
 005B 1600DE            jsr _keyboard_get_column
 005E 6C1C              std -4,x
 0060                   .dbline 45
 0060           ; }
 0060           ; }
 0060           ; }
 0060 EC1C              ldd -4,x
 0062 8CFFFF            cpd #-1
 0065 274F              beq L11
 0067                   .dbline 45
 0067                   .dbline 46
 0067           ; }
 0067 FC0000            ldd L5
 006A AC1E              cpd -2,x
 006C 260F              bne L13
 006E FC0002            ldd L6
 0071 AC1C              cpd -4,x
 0073 2608              bne L13
 0075                   .dbline 46
 0075                   .dbline 47
 0075           ; }
 0075 CCF000            ldd #0xf000
 0078 160134            jsr _keyboard_delay
 007B                   .dbline 48
 007B 2006              bra L14
 007D           L13:
 007D                   .dbline 48
 007D           ; }
 007D                   .dbline 49
 007D           ; }
 007D CC5000            ldd #20480
 0080 160134            jsr _keyboard_delay
 0083                   .dbline 50
 0083           ; }
 0083           L14:
 0083                   .dbline 53
 0083           ; }
 0083           ; }
 0083           ; }
 0083 1600DE            jsr _keyboard_get_column
 0086 6CE1EA            std -22,x
 0089 EC1C              ldd -4,x
 008B ACE1EA            cpd -22,x
 008E 2633              bne L12
 0090                   .dbline 53
 0090                   .dbline 55
 0090           ; }
 0090           ; }
 0090 18051E0000        movw -2,x,L5
 0095                   .dbline 56
 0095           ; }
 0095 18051C0002        movw -4,x,L6
 009A                   .dbline 57
 009A           ; }
 009A EC1E              ldd -2,x
 009C 59                lsld
 009D 59                lsld
 009E 19E1EC            leay -20,x
 00A1 6DE1E8            sty -24,x
 00A4 E3E1E8            addd -24,x
 00A7 6CE1E6            std -26,x
 00AA EC1C              ldd -4,x
 00AC E3E1E6            addd -26,x
 00AF B7C6              xgdy
 00B1 E640              ldab 0,y
 00B3 87                clra
 00B4 2024              bra L4
 00B6           X3:
 00B6                   .dbline 59
 00B6           L11:
 00B6                   .dbline 59
 00B6           ; }
 00B6           ; }
 00B6 EC1E              ldd -2,x
 00B8 BC0000            cpd L5
 00BB 2606              bne L17
 00BD                   .dbline 59
 00BD                   .dbline 61
 00BD           ; }
 00BD           ; }
 00BD CCFFFF            ldd #-1
 00C0 7C0002            std L6
 00C3                   .dbline 62
 00C3           ; }
 00C3           L17:
 00C3           L12:
 00C3                   .dbline 65
 00C3 EC1E              ldd -2,x
 00C5 C30001            addd #1
 00C8 CD0004            ldy #4
 00CB B7D6              exg x,y
 00CD 1815              idivs
 00CF B7D6              exg x,y
 00D1 6C1E              std -2,x
 00D3                   .dbline 66
 00D3           L9:
 00D3                   .dbline 40
 00D3 1820FF73          lbra L8
 00D7           X4:
 00D7                   .dbline 68
 00D7           ; }
 00D7           ; }
 00D7           ; }
 00D7           ; }
 00D7           ; }
 00D7           ; }
 00D7 CC0000            ldd #0
 00DA                   .dbline -2
 00DA           L4:
 00DA B757              tfr x,s
 00DC 30                pulx
 00DD                   .dbline 0 ; func end
 00DD 3D                rts
 00DE                   .dbsym l char_map -20 A[16:4:4]c
 00DE                   .dbsym l col -4 I
 00DE                   .dbsym l row -2 I
 00DE                   .dbend
 00DE                   .dbfunc s keyboard_get_column _keyboard_get_column fI
 00DE           ;          input -> -4,x
 00DE           ;            col -> -2,x
 00DE           _keyboard_get_column:
 00DE 34                pshx
 00DF B775              tfr s,x
 00E1 1B9C              leas -4,sp
 00E3                   .dbline -1
 00E3                   .dbline 76
 00E3           ; ä
 00E3           ; ä
 00E3           ; ä
 00E3           ; ä
 00E3           ; ä
 00E3           ; ä
 00E3           ; ä
 00E3           ; ä
 00E3                   .dbline 77
 00E3           ; ä
 00E3 CC0000            ldd #0
 00E6 6C1E              std -2,x
 00E8                   .dbline 78
 00E8           ; ä
 00E8                   ; vol
 00E8 F60260            ldab 0x260
 00EB 87                clra
 00EC 47                asra
 00ED 56                rorb
 00EE 47                asra
 00EF 56                rorb
 00F0 47                asra
 00F1 56                rorb
 00F2 47                asra
 00F3 56                rorb
 00F4 6C1C              std -4,x
 00F6                   .dbline 81
 00F6           ; ä
 00F6           ; ä
 00F6           ; ä
 00F6 EC1C              ldd -4,x
 00F8 2605              bne L20
 00FA                   .dbline 81
 00FA CCFFFF            ldd #-1
 00FD 2031              bra L19
 00FF           L20:
 00FF                   .dbline 85
 00FF CC0000            ldd #0
 0102 6C1E              std -2,x
 0104           L22:
 0104                   .dbline 85
 0104           ; ä
 0104           ; ä
 0104           ; ä
 0104           ; ä
 0104                   .dbline 86
 0104           ; ä
 0104 EC1C              ldd -4,x
 0106 ED1E              ldy -2,x
 0108 8D0000            cpy #0
 010B 2705              beq X5
 010D           X6:
 010D 47                asra
 010E 56                rorb
 010F 0436FB            dbne y,X6
 0112           X5:
 0112 8400              anda #0
 0114 C401              andb #1
 0116 8C0000            cpd #0
 0119 2704              beq L26
 011B                   .dbline 86
 011B                   .dbline 87
 011B           ; ä
 011B EC1E              ldd -2,x
 011D 2011              bra L19
 011F           L26:
 011F                   .dbline 89
 011F           L23:
 011F                   .dbline 85
 011F EC1E              ldd -2,x
 0121 C30001            addd #1
 0124 6C1E              std -2,x
 0126                   .dbline 85
 0126 EC1E              ldd -2,x
 0128 8C0004            cpd #4
 012B 2DD7              blt L22
 012D                   .dbline 91
 012D           ; ä
 012D           ; ä
 012D           ; ä
 012D           ; ä
 012D CCFFFF            ldd #-1
 0130                   .dbline -2
 0130           L19:
 0130 B757              tfr x,s
 0132 30                pulx
 0133                   .dbline 0 ; func end
 0133 3D                rts
 0134                   .dbsym l input -4 I
 0134                   .dbsym l col -2 I
 0134                   .dbend
 0134                   .dbfunc s keyboard_delay _keyboard_delay fV
 0134           ;          delay -> 2,x
 0134           _keyboard_delay:
 0134 3B                pshd
 0135 34                pshx
 0136 B775              tfr s,x
 0138                   .dbline -1
 0138                   .dbline 98
 0138           ; ä
 0138           ; ä
 0138           ; ä
 0138           ; ä
 0138           ; ä
 0138           ; ä
 0138           ; ä
 0138                   .dbline 99
 0138 2007              bra L32
 013A           L29:
 013A                   .dbline 99
 013A                   .dbline 99
 013A           L30:
 013A                   .dbline 99
 013A EC02              ldd 2,x
 013C 830001            subd #1
 013F 6C02              std 2,x
 0141           L32:
 0141                   .dbline 99
 0141           ; ä
 0141 EC02              ldd 2,x
 0143 26F5              bne L29
 0145                   .dbline -2
 0145                   .dbline 100
 0145           ; ä
 0145           L28:
 0145 B757              tfr x,s
 0147 30                pulx
 0148 1B82              leas 2,sp
 014A                   .dbline 0 ; func end
 014A 3D                rts
 014B                   .dbsym l delay 2 i
 014B                   .dbend
 014B                   .dbfile M:\SYSC20~2\Assignments\ASSIGN~3\PART1~1\assign41.c
 014B                   .dbfunc e main _main fI
 014B           ;            key -> -1,x
 014B           _main::
 014B 34                pshx
 014C B775              tfr s,x
 014E 1B9E              leas -2,sp
 0150                   .dbline -1
 0150                   .dbline 6
 0150                   .dbline 10
 0150 CC001A            ldd #26
 0153 160000            jsr _setbaud
 0156 2013              bra L35
 0158           L34:
 0158                   .dbline 12
 0158                   .dbline 13
 0158 16001D            jsr _keyboard_getchar
 015B 6B1F              stab -1,x
 015D                   .dbline 14
 015D E61F              ldab -1,x
 015F 87                clra
 0160 160000            jsr _putchar
 0163                   .dbline 16
 0163 E61F              ldab -1,x
 0165 C130              cmpb #48
 0167 2602              bne L37
 0169                   .dbline 16
 0169                   .dbline 17
 0169 2002              bra L36
 016B           L37:
 016B                   .dbline 19
 016B           L35:
 016B                   .dbline 12
 016B 20EB              bra L34
 016D           L36:
 016D                   .dbline 21
 016D CC0001            ldd #1
 0170                   .dbline -2
 0170           L33:
 0170 B757              tfr x,s
 0172 30                pulx
 0173                   .dbline 0 ; func end
 0173 3D                rts
 0174                   .dbsym l key -1 c
 0174                   .dbend
